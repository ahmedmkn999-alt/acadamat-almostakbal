<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FULL MARK | المواد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="auth.js"></script>
    <style>
        body { background: #020617; color: white; font-family: 'Tajawal'; }
        .subject-card { 
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255,255,255,0.1); 
            transition: all 0.3s ease;
        }
        .subject-card:hover { 
            transform: translateY(-8px); 
            border-color: #fbbf24; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app">
        <header class="flex justify-between items-center mb-8 bg-slate-800/80 p-4 rounded-xl border border-white/10">
            <div class="flex items-center gap-3">
                <img src="https://cdn-icons-png.flaticon.com/512/3413/3413535.png" class="w-10 h-10">
                <h1 class="text-xl font-bold text-yellow-400">المواد الدراسية</h1>
            </div>
            <button onclick="logout()" class="text-red-400 font-bold hover:text-red-300 transition">خروج</button>
        </header>

        <div v-if="loading" class="text-center mt-20">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400 mx-auto mb-4"></div>
            <p>جاري تحميل المواد...</p>
        </div>
        
        <div v-else class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <div v-for="sub in subjects" :key="sub.id" @click="openSub(sub)" class="subject-card p-4 rounded-2xl text-center cursor-pointer flex flex-col items-center">
                <div class="w-full h-32 mb-4 rounded-xl overflow-hidden bg-slate-900">
                    <img :src="getImg(sub.name)" class="w-full h-full object-cover opacity-90 hover:opacity-100 transition hover:scale-110 duration-500">
                </div>
                <h3 class="font-bold text-lg mb-2">{{ sub.name }}</h3>
                <span class="text-xs text-gray-400 bg-black/30 px-3 py-1 rounded-full">{{ sub.teachers?.length || 0 }} مدرسين</span>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        const URLS = {
            'علمي علوم': "https://plus-teal.vercel.app/organized_output.json",
            'أدبي': "https://plus-teal.vercel.app/organized_output-a.json", 
            'علمي رياضة': "https://platform-sigma-seven.vercel.app/organized_output-e.json",
            'أزهر': "https://plus-teal.vercel.app/organized_output.json"
        };
        
        // صور جديدة احترافية
        const IMGS = {
            "لغة عربية": "https://images.unsplash.com/photo-1541963463532-d68292c34b19?w=600&q=80",
            "لغة إنجليزية": "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=600&q=80",
            "لغة فرنسية": "https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=600&q=80",
            "أحياء": "https://images.unsplash.com/photo-1530026405124-efe3d232b3d8?w=600&q=80",
            "كيمياء": "https://images.unsplash.com/photo-1603126857599-f6e157fa2fe6?w=600&q=80",
            "فيزياء": "https://images.unsplash.com/photo-1636466497217-26a8cbeaf0aa?w=600&q=80",
            "جيولوجيا": "https://images.unsplash.com/photo-1598281838025-6c930063d2e1?w=600&q=80",
            "الرياضيات": "https://images.unsplash.com/photo-1635070041043-e3f001e34750?w=600&q=80",
            "تاريخ": "https://images.unsplash.com/photo-1461360228754-6e81c478b882?w=600&q=80",
            "جغرافيا": "https://images.unsplash.com/photo-1521295121783-8a321d551ad2?w=600&q=80",
            "فلسفة": "https://images.unsplash.com/photo-1604871000398-e4f52071d955?w=600&q=80",
            "علم نفس": "https://images.unsplash.com/photo-1589519160732-57fc498494f8?w=600&q=80",
            "default": "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=600&q=80"
        };

        createApp({
            setup() {
                const subjects = ref([]);
                const loading = ref(true);
                const yid = ref(null);

                const getImg = (n) => {
                    for(let k in IMGS) if(n.includes(k)) return IMGS[k];
                    return IMGS['default'];
                };
                
                const openSub = (s) => window.location.href = `chapters.html?yid=${yid.value}&sid=${s.id}`;
                
                onMounted(async () => {
                    const code = localStorage.getItem('activeCode');
                    const db = firebase.database();
                    const snap = await db.ref('approvedStudents/' + code).once('value');
                    const section = snap.val()?.section?.trim() || 'علمي علوم';
                    
                    try {
                        const res = await fetch(URLS[section] || URLS['علمي علوم']);
                        const data = await res.json();
                        let year = data.find(y => y.name.includes('3') || y.id == 3) || data[0];
                        yid.value = year.id;
                        subjects.value = year.subjects || [];
                    } catch(e) {}
                    loading.value = false;
                });
                return { subjects, loading, getImg, openSub };
            }
        }).mount('#app');

        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
    </script>
</body>
    </html>
    
