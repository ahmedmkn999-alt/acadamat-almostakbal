<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Full Mark | Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script type="module" src="devcheck.js"></script>
<script src="auth.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700&family=Orbitron:wght@600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --dark-black: #020A07;
    --main-green-bg: #08402C;
    --darker-green-bg: #0C241C;
    --neon-accent: #00F5C4;
    --success: #00C896;
    --error: #FF4F4F;
    --light-text: #f0f0f5;
    --gray-text: #8e8e8e;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Cairo', 'Tajawal', sans-serif;
    background: linear-gradient(145deg, var(--dark-black) 10%, var(--darker-green-bg) 100%);
    color: var(--light-text);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    position: relative;
  }
  
  .header-signature {
      position: absolute;
      top: 25px;
      right: 25px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      font-weight: 900;
      background: linear-gradient(45deg, var(--neon-accent), var(--light-text));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 10px rgba(0, 245, 196, 0.7);
      letter-spacing: 2px;
      padding: 5px 10px;
      user-select: none;
      border-bottom: 3px solid var(--neon-accent); 
  }

  .profile-container {
    background: rgba(12, 36, 28, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 40px 25px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7), 0 0 20px rgba(0, 245, 196, 0.1); 
    text-align: center;
    border: 1px solid rgba(0, 245, 196, 0.3);
    position: relative;
    z-index: 10;
  }

  .profile-avatar {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    margin: auto;
    border: 3px solid var(--neon-accent);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2.5rem;
    background: var(--darker-green-bg);
    color: var(--light-text);
    font-weight: bold;
    margin-bottom: 15px;
    box-shadow: 0 0 20px rgba(0, 245, 196, 0.4);
  }

  .profile-name {
    font-family: 'Tajawal', sans-serif;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--light-text);
    margin-bottom: 5px;
  }

  .profile-section {
    font-size: 0.9rem;
    color: var(--neon-accent);
    margin-bottom: 25px;
    font-weight: 600;
    background: rgba(0, 245, 196, 0.1);
    padding: 5px 15px;
    border-radius: 20px;
    display: inline-block;
  }

  .info-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 12px;
    margin: 15px 0;
    text-align: right;
    font-size: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .info-item {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }
  .info-item:last-child { border-bottom: none; }

  .info-label { color: var(--gray-text); font-weight: 500; }
  .info-value { font-weight: 700; color: var(--light-text); }

  .status-value.active { color: var(--success); text-shadow: 0 0 8px var(--success); }
  .status-value.expired { color: var(--error); }

  /* Digital Timer */
  .timer-box {
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      border: 1px solid rgba(0, 245, 196, 0.2);
  }
  
  .timer-title { color: var(--gray-text); font-size: 0.9rem; margin-bottom: 5px; }

  .timer {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--neon-accent);
    letter-spacing: 2px;
    text-shadow: 0 0 10px rgba(0, 245, 196, 0.5);
  }

  /* Progress Bar */
  .progress-container {
    background: #000;
    border-radius: 10px;
    overflow: hidden;
    height: 8px;
    margin-top: 10px;
  }

  .progress-bar {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, var(--neon-accent), var(--success));
    transition: width 1s linear;
    border-radius: 10px;
    box-shadow: 0 0 10px var(--neon-accent);
  }

  .back-btn {
    margin-top: 25px;
    padding: 12px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--main-green-bg), #063020);
    border: 1px solid var(--neon-accent);
    color: var(--neon-accent);
    font-size: 1rem;
    cursor: pointer;
    width: 100%;
    font-weight: 700;
    transition: 0.3s;
  }

  .back-btn:hover {
    background: var(--neon-accent);
    color: #000;
    box-shadow: 0 0 15px var(--neon-accent);
  }
  
  .fixed-bottom-bar {
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: rgba(2, 10, 7, 0.95);
    border-top: 2px solid var(--neon-accent);
    color: var(--light-text);
    text-align: center;
    padding: 10px 0;
    z-index: 999; 
    display: flex; justify-content: center; align-items: center; gap: 10px;
  }

  .bottom-code {
    color: var(--neon-accent); 
    font-size: 1.2rem;
    font-weight: 700;
    font-family: 'Orbitron', monospace; 
    letter-spacing: 2px;
  }
</style>
</head>
<body>
    
  <div class="header-signature">FULL MARK</div>

  <div class="profile-container">
    <div class="profile-avatar" id="profileAvatar">ğŸ“</div>
    <h2 class="profile-name" id="profileName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
    <div class="profile-section" id="profileSection">...</div>

    <div class="info-card">
      <div class="info-item">
        <span class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span>
        <span id="profileStatus" class="status-value">...</span>
      </div>
      <div class="info-item">
        <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„</span>
        <span class="info-value" id="startDate">...</span>
      </div>
    </div>
    
    <div class="timer-box" id="timerBox" style="display: none;">
        <div class="timer-title">ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ù„Ø§Ù„</div>
        <div class="timer" id="profileTimer">00:00:00:00</div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <button class="back-btn" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¯</button>
  </div>
    
    <div class="fixed-bottom-bar">
      <span style="color: #888;">Code:</span>
      <span id="displayActivationCodeBottom" class="bottom-code">...</span>
    </div>
  
<script>
  // 1. Firebase Config (Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
  const firebaseConfig = {
      apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
      authDomain: "thanawy-1383.firebaseapp.com",
      databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
      projectId: "thanawy-1383",
      storageBucket: "thanawy-1383.firebasestorage.app",
      messagingSenderId: "1026664406457",
      appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
      measurementId: "G-J5R2EFM2D0"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 2. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø·
  const activeCode = localStorage.getItem('activeCode');
  
  if (activeCode) {
      document.getElementById('displayActivationCodeBottom').textContent = activeCode;
      loadProfileData(activeCode);
  } else {
      window.location.href = "index.html";
  }

  function loadProfileData(code) {
      db.ref('approvedStudents/' + code).once('value').then((snapshot) => {
          const data = snapshot.val();
          
          if (data) {
              // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
              document.getElementById("profileName").textContent = data.studentName || "Ø·Ø§Ù„Ø¨ Ù…Ø¬ØªÙ‡Ø¯";
              document.getElementById("profileSection").textContent = data.section || "Ø¹Ø§Ù…";
              document.getElementById("profileAvatar").textContent = data.studentName ? data.studentName.charAt(0).toUpperCase() : "ğŸ“";
              
              // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
              const startDate = new Date(data.activationDate || Date.now()); // Ù„Ùˆ Ù…ÙÙŠØ´ ØªØ§Ø±ÙŠØ® Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
              document.getElementById("startDate").textContent = startDate.toLocaleDateString('ar-EG');

              // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
              if (data.expiry) {
                  document.getElementById("timerBox").style.display = "block";
                  startCountdown(data.expiry, data.activationDate);
                  
                  if (Date.now() < data.expiry) {
                      document.getElementById("profileStatus").textContent = "âœ… Ù†Ø´Ø·";
                      document.getElementById("profileStatus").className = "status-value active";
                  } else {
                      document.getElementById("profileStatus").textContent = "âŒ Ù…Ù†ØªÙ‡ÙŠ";
                      document.getElementById("profileStatus").className = "status-value expired";
                  }
              } else {
                  // Ø§Ø´ØªØ±Ø§Ùƒ Ù…ÙØªÙˆØ­
                  document.getElementById("profileStatus").textContent = "â™¾ï¸ Ù…ÙØªÙˆØ­";
                  document.getElementById("profileStatus").className = "status-value active";
              }

          } else {
              alert("Ø®Ø·Ø£: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
              window.location.href = "index.html";
          }
      });
  }

  function startCountdown(expiryTime, startTime) {
      const timerEl = document.getElementById("profileTimer");
      const progressBar = document.getElementById("progressBar");
      const totalDuration = expiryTime - (startTime || Date.now());

      function update() {
          const now = Date.now();
          const distance = expiryTime - now;

          if (distance <= 0) {
              timerEl.textContent = "00:00:00:00";
              progressBar.style.width = "0%";
              return;
          }

          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);

          timerEl.textContent = `${days}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

          // Progress Bar (Ø¹ÙƒØ³ÙŠ: ÙŠÙ†Ù‚Øµ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª)
          const percent = (distance / totalDuration) * 100;
          progressBar.style.width = Math.max(0, Math.min(100, percent)) + "%";
      }

      update();
      setInterval(update, 1000);
  }

  function goBack() {
      window.location.href = "chapters.html";
  }
</script>

</body>
                                                      </html>
                                                      
