<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مشغل الفيديو</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* إجبار الفيديو على ملء الشاشة */
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; }
        .video-container { width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; }
        
        /* تخصيص ألوان المشغل (أزرق وذهبي) */
        :root { --plyr-color-main: #3b82f6; }
        .plyr--full-ui input[type=range] { color: #fbbf24 !important; }
        .plyr__control--overlaid { background: rgba(59, 130, 246, 0.9) !important; }
        
        /* زر الرجوع */
        .back-btn {
            position: absolute; top: 20px; right: 20px; z-index: 50;
            background: rgba(0, 0, 0, 0.6); color: white; width: 45px; height: 45px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>

    <div onclick="history.back()" class="back-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
        </svg>
    </div>

    <div class="video-container">
        <video id="player" playsinline controls data-poster="https://via.placeholder.com/1920x1080/000000/FFFFFF?text=Loading...">
            </video>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        const vData = JSON.parse(localStorage.getItem('currentVideo'));
        const element = document.getElementById('player');

        if (vData) {
            let url = vData.stream_url || vData.link || vData.url || vData.video_url;

            // لو يوتيوب
            if (url.includes('youtube') || url.includes('youtu.be')) {
                document.querySelector('.video-container').innerHTML = `
                    <div id="player" data-plyr-provider="youtube" data-plyr-embed-id="${url}"></div>
                `;
            } else {
                element.src = url;
            }

            // تشغيل المشغل
            const player = new Plyr('#player', {
                controls: [
                    'play-large', 'play', 'progress', 'current-time', 'duration', 
                    'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'
                ],
                settings: ['captions', 'quality', 'speed'],
                speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
                fullscreen: { enabled: true, fallback: true, iosNative: true },
                ratio: '16:9',
                autoplay: true
            });

        } else {
            alert("فشل تحميل الفيديو!");
            history.back();
        }
    </script>
</body>
</html>
