<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Video Player</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* جعل الفيديو يملأ الشاشة بالكامل */
        .video-wrapper {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
        }
        
        /* تخصيص ألوان المشغل للأزرق والذهبي */
        :root { --plyr-color-main: #3b82f6; }
        .plyr--full-ui input[type=range] { color: #fbbf24 !important; }
        .plyr__control--overlaid { background: rgba(59, 130, 246, 0.8) !important; }
        
        /* زر الرجوع العائم */
        .back-btn {
            position: absolute; top: 20px; right: 20px; z-index: 50;
            background: rgba(0,0,0,0.5); color: white; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(5px);
        }

        /* طبقة اللمس المزدوج (Double Tap) */
        .tap-layer {
            position: absolute; top: 0; bottom: 0; width: 35%; z-index: 20;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: bold; color: white; opacity: 0; transition: 0.3s; pointer-events: auto;
        }
        .tap-left { left: 0; background: linear-gradient(90deg, rgba(0,0,0,0.4), transparent); }
        .tap-right { right: 0; background: linear-gradient(-90deg, rgba(0,0,0,0.4), transparent); }
    </style>
</head>
<body>

    <div onclick="history.back()" class="back-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
        </svg>
    </div>

    <div class="video-wrapper">
        <video id="player" playsinline controls data-poster="https://via.placeholder.com/1920x1080/000000/FFFFFF?text=FullMark+Player">
            </video>

        <div id="tapLeft" class="tap-layer tap-left">⏪ 10s</div>
        <div id="tapRight" class="tap-layer tap-right">10s ⏩</div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        const vData = JSON.parse(localStorage.getItem('currentVideo'));
        const videoEl = document.getElementById('player');
        
        if (vData) {
            let src = vData.stream_url || vData.link || vData.url || vData.video_url;

            // دعم يوتيوب بشكل كامل
            if (src.includes('youtube') || src.includes('youtu.be')) {
                // تحويل الفيديو لـ Embed يوتيوب مدعوم من Plyr
                document.querySelector('.video-wrapper').innerHTML = `
                    <div id="player" data-plyr-provider="youtube" data-plyr-embed-id="${src}"></div>
                    <div id="tapLeft" class="tap-layer tap-left">⏪ 10s</div>
                    <div id="tapRight" class="tap-layer tap-right">10s ⏩</div>
                `;
            } else {
                videoEl.src = src;
            }

            // تشغيل المشغل بالإعدادات الكاملة
            const player = new Plyr('#player', {
                controls: [
                    'play-large', 'play', 'progress', 'current-time', 'duration', 
                    'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'
                ],
                settings: ['captions', 'quality', 'speed'],
                speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
                fullscreen: { enabled: true, fallback: true, iosNative: true }, // تفعيل التكبير الإجباري
                ratio: '16:9' // نسبة العرض للارتفاع
            });

            // ⚡ كود اللمس المزدوج (Double Tap)
            let lastTap = 0;
            const tapLeft = document.getElementById('tapLeft');
            const tapRight = document.getElementById('tapRight');

            // دالة لإظهار التأثير
            function showTapEffect(el) {
                el.style.opacity = '1';
                setTimeout(() => el.style.opacity = '0', 500);
            }

            // تقديم (يمين)
            tapRight.addEventListener('click', (e) => {
                const now = new Date().getTime();
                if (now - lastTap < 300) {
                    player.forward(10);
                    showTapEffect(tapRight);
                }
                lastTap = now;
            });

            // تأخير (يسار)
            tapLeft.addEventListener('click', (e) => {
                const now = new Date().getTime();
                if (now - lastTap < 300) {
                    player.rewind(10);
                    showTapEffect(tapLeft);
                }
                lastTap = now;
            });

        } else {
            alert("لا يوجد فيديو!");
            history.back();
        }
    </script>
</body>
</html>
