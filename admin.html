<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© | Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; overflow-x: hidden; }
        .sidebar { background: #1e293b; min-height: 100vh; border-left: 1px solid #334155; }
        .nav-item { cursor: pointer; padding: 15px; margin: 5px 10px; border-radius: 10px; color: #94a3b8; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover, .nav-item.active { background: #3b82f6; color: white; }
        .login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020617; z-index: 50; display: flex; justify-content: center; align-items: center; }
        .card { background: #1e293b; border: 1px solid #334155; padding: 20px; border-radius: 15px; }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 w-96 text-center shadow-2xl">
            <div class="w-20 h-20 bg-blue-600 rounded-full mx-auto flex items-center justify-center mb-6 shadow-lg">
                <i class="fas fa-lock text-3xl text-white"></i>
            </div>
            <h2 class="text-2xl font-bold mb-6 text-white">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
            <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-600 text-white mb-4 focus:border-blue-500 outline-none">
            <button onclick="checkLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold transition">Ø¯Ø®ÙˆÙ„</button>
            <p id="errorMsg" class="text-red-500 mt-4 text-sm hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!</p>
        </div>
    </div>

    <div id="dashboard" class="flex hidden">
        
        <div class="sidebar w-64 hidden md:block">
            <div class="p-6 text-center border-b border-slate-700 mb-4">
                <h1 class="text-2xl font-bold text-yellow-400">FULL MARK</h1>
                <p class="text-xs text-gray-400">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
            </div>
            <nav>
                <div onclick="showPage('home')" class="nav-item active" id="nav-home"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <div onclick="showPage('create')" class="nav-item" id="nav-create"><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯</div>
                <div onclick="showPage('users')" class="nav-item" id="nav-users"><i class="fas fa-users"></i> Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</div>
            </nav>
        </div>

        <div class="flex-1 p-6 md:p-10">
            <div class="md:hidden mb-6 flex justify-between items-center">
                <h1 class="text-xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                <div class="flex gap-2">
                     <button onclick="showPage('home')" class="p-2 bg-slate-800 rounded"><i class="fas fa-home"></i></button>
                     <button onclick="showPage('create')" class="p-2 bg-slate-800 rounded"><i class="fas fa-plus"></i></button>
                     <button onclick="showPage('users')" class="p-2 bg-slate-800 rounded"><i class="fas fa-users"></i></button>
                </div>
            </div>

            <div id="page-home" class="page-content">
                <h2 class="text-3xl font-bold mb-6 text-yellow-400">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card">
                        <h3 class="text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
                        <p id="totalRevenue" class="text-4xl font-bold text-green-400 mt-2">0 Ø¬.Ù…</p>
                    </div>
                    <div class="card">
                        <h3 class="text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                        <p id="totalStudents" class="text-4xl font-bold text-blue-400 mt-2">0</p>
                    </div>
                    <div class="card">
                        <h3 class="text-gray-400">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h3>
                        <p id="soldCodes" class="text-4xl font-bold text-yellow-400 mt-2">0</p>
                    </div>
                </div>
            </div>

            <div id="page-create" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-blue-400">Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h2>
                <div class="card max-w-xl">
                    <div class="space-y-4">
                        <input id="stdName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl text-white">
                        <select id="stdSection" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl text-white">
                            <option>Ø¹Ù„Ù…ÙŠ Ø¹Ù„ÙˆÙ…</option><option>Ø¹Ù„Ù…ÙŠ Ø±ÙŠØ§Ø¶Ø©</option><option>Ø£Ø¯Ø¨ÙŠ</option><option>Ø£Ø²Ù‡Ø±</option>
                        </select>
                        <div class="grid grid-cols-2 gap-4">
                            <select id="codeType" class="bg-slate-900 border border-slate-700 p-4 rounded-xl text-white">
                                <option value="month">Ø´Ù‡Ø± ÙƒØ§Ù…Ù„</option>
                                <option value="trial">ØªØ¬Ø±ÙŠØ¨ÙŠ</option>
                            </select>
                            <input id="codePrice" type="number" value="100" class="bg-slate-900 border border-slate-700 p-4 rounded-xl text-white text-center">
                        </div>
                        <button onclick="generateCode()" class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-xl font-bold text-lg shadow-lg">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>
                    </div>
                    <div id="resultArea" class="hidden mt-6 p-4 bg-green-900/30 border border-green-500/50 rounded-xl text-center">
                        <div id="generatedCode" class="text-4xl font-mono font-bold text-white tracking-widest cursor-pointer" onclick="navigator.clipboard.writeText(this.innerText)"></div>
                        <p class="text-xs text-gray-400 mt-2">Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</p>
                    </div>
                </div>
            </div>

            <div id="page-users" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white">Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h2>
                    <input type="text" id="searchBox" onkeyup="filterTable()" placeholder="Ø¨Ø­Ø«..." class="bg-slate-900 border border-slate-700 px-4 py-2 rounded-lg text-white">
                </div>
                <div class="overflow-x-auto rounded-xl border border-slate-700">
                    <table class="w-full text-right text-sm">
                        <thead class="bg-slate-800 text-gray-400">
                            <tr><th class="p-4">Ø§Ù„Ø·Ø§Ù„Ø¨</th><th class="p-4">Ø§Ù„ÙƒÙˆØ¯</th><th class="p-4">Ø§Ù„Ù†ÙˆØ¹</th><th class="p-4">ØªØ­ÙƒÙ…</th></tr>
                        </thead>
                        <tbody id="studentsTable" class="divide-y divide-slate-700 bg-slate-900/50"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØ¬ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§)
        const firebaseConfig = {
             apiKey: "AIzaSyD1QB3qaFfkGYq0OWOEAr83V25NAPFwxzs",
            authDomain: "fullmark-2025.firebaseapp.com",
            databaseURL: "https://fullmark-2025-default-rtdb.firebaseio.com",
            projectId: "fullmark-2025",
            storageBucket: "fullmark-2025.firebasestorage.app",
            messagingSenderId: "963956202032",
            appId: "1:963956202032:web:4df914457d79b75dee2bf5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„
        function checkLogin() {
            const pass = document.getElementById('adminPass').value;
            if (pass === 'ahmedmo12345') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').classList.remove('hidden');
                loadData(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
            } else {
                document.getElementById('errorMsg').classList.remove('hidden');
            }
        }

        // ğŸ”„ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navBtn = document.getElementById('nav-' + pageId);
            if(navBtn) navBtn.classList.add('active');
        }

        // âš™ï¸ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚)
        function generateCode() {
            const name = document.getElementById('stdName').value;
            const section = document.getElementById('stdSection').value;
            const type = document.getElementById('codeType').value;
            const price = document.getElementById('codePrice').value;

            if(!name) return alert('Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            const duration = type === 'trial' ? 3600000 : 2592000000;

            db.ref('approvedStudents/' + code).set({
                studentName: name, section: section, type: type, price: price,
                expiry: Date.now() + duration, isBlocked: false, deviceId: null
            }).then(() => {
                document.getElementById('resultArea').classList.remove('hidden');
                document.getElementById('generatedCode').innerText = code;
            });
        }

        function loadData() {
            db.ref('approvedStudents').on('value', snap => {
                const list = document.getElementById('studentsTable');
                list.innerHTML = '';
                let totalS = 0, totalM = 0, totalSold = 0;

                if(snap.exists()) {
                    const data = snap.val();
                    Object.entries(data).reverse().forEach(([code, std]) => {
                        totalS++;
                        if(std.type !== 'trial') { totalM += parseInt(std.price || 0); totalSold++; }

                        const row = `<tr>
                            <td class="p-4 font-bold">${std.studentName}<div class="text-xs text-gray-500">${std.section}</div></td>
                            <td class="p-4 font-mono text-yellow-400 select-all">${code}</td>
                            <td class="p-4"><span class="bg-slate-700 px-2 py-1 rounded text-xs">${std.type === 'trial' ? 'ØªØ¬Ø±ÙŠØ¨ÙŠ' : 'Ø´Ù‡Ø±'}</span></td>
                            <td class="p-4"><button onclick="deleteUser('${code}')" class="text-red-400"><i class="fas fa-trash"></i></button></td>
                        </tr>`;
                        list.innerHTML += row;
                    });
                }
                document.getElementById('totalStudents').innerText = totalS;
                document.getElementById('totalRevenue').innerText = totalM;
                document.getElementById('soldCodes').innerText = totalSold;
            });
        }

        function deleteUser(c) { if(confirm('Ø­Ø°ÙØŸ')) db.ref('approvedStudents/'+c).remove(); }
        function filterTable() { /* ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚ */ }
    </script>
</body>
    </html>
    
