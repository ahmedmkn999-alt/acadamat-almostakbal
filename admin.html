<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Mark | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root {
            --bg-dark: #020617;
            --primary-blue: #1e3a8a;
            --accent-gold: #fbbf24;
            --glass-border: rgba(59, 130, 246, 0.3);
            --text-light: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .admin-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            width: 90%; max-width: 500px;
            box-shadow: 0 0 50px rgba(30, 58, 138, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* Ø´Ø±ÙŠØ· Ø°Ù‡Ø¨ÙŠ Ø¹Ù„ÙˆÙŠ */
        .admin-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-gold));
        }

        h2 {
            text-align: center; font-size: 2rem; margin-bottom: 30px;
            color: var(--accent-gold); text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #94a3b8; }
        
        input, select {
            width: 100%; padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; color: white; font-size: 1rem;
            outline: none; transition: 0.3s;
        }
        input:focus, select:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.2);
        }

        button {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: linear-gradient(90deg, #2563eb, #1d4ed8);
            color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            transition: 0.3s; margin-top: 10px;
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ */
        .result-box {
            margin-top: 30px; padding: 20px;
            background: rgba(0, 255, 153, 0.1);
            border: 1px solid #10b981;
            border-radius: 12px;
            text-align: center;
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            animation: slideUp 0.5s ease;
        }
        @keyframes slideUp { from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);} }

        .generated-code {
            font-family: monospace; font-size: 2rem; font-weight: bold;
            color: var(--accent-gold); letter-spacing: 5px; margin: 10px 0;
            display: block; text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1); margin-top: 10px; font-size: 0.9rem; padding: 8px;
        }
    </style>
</head>
<body>

    <div class="admin-card">
        <h2><i class="fas fa-user-shield"></i> Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø·Ø§Ù„Ø¨</h2>

        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="stdName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
        </div>

        <div class="form-group">
            <label>Ø§Ù„Ø´Ø¹Ø¨Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
            <select id="stdSection">
                <option value="Ø¹Ù„Ù…ÙŠ Ø¹Ù„ÙˆÙ…">ğŸ§¬ Ø¹Ù„Ù…ÙŠ Ø¹Ù„ÙˆÙ…</option>
                <option value="Ø¹Ù„Ù…ÙŠ Ø±ÙŠØ§Ø¶Ø©">ğŸ“ Ø¹Ù„Ù…ÙŠ Ø±ÙŠØ§Ø¶Ø©</option>
                <option value="Ø£Ø¯Ø¨ÙŠ">ğŸ“œ Ø£Ø¯Ø¨ÙŠ</option>
            </select>
        </div>

        <div class="form-group">
            <label>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
            <input type="number" id="stdDays" value="30">
        </div>

        <button onclick="generateCode()" id="genBtn">âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ­ÙØ¸Ù‡</button>

        <div id="resultArea" class="result-box">
            <p style="color:#10b981; font-weight:bold;">ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ…</p>
            <span id="codeDisplay" class="generated-code">------</span>
            <button class="copy-btn" onclick="copyCode()">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
        </div>
    </div>

    <script>
        // ğŸš¨ 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª)
        const firebaseConfig = {
            apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
            authDomain: "thanawy-1383.firebaseapp.com",
            databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
            projectId: "thanawy-1383",
            storageBucket: "thanawy-1383.firebasestorage.app",
            messagingSenderId: "1026664406457",
            appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // 2. Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯
        function generateCode() {
            const name = document.getElementById('stdName').value.trim();
            const section = document.getElementById('stdSection').value;
            const days = parseInt(document.getElementById('stdDays').value);
            const btn = document.getElementById('genBtn');

            if (!name) {
                alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨!");
                return;
            }

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            btn.disabled = true;

            // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            
            // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
            const expiryDate = Date.now() + (days * 24 * 60 * 60 * 1000);

            // Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            db.ref('approvedStudents/' + code).set({
                studentName: name,
                section: section,
                expiry: expiryDate,
                deviceId: null, // ÙØ§Ø¶ÙŠ Ø¹Ø´Ø§Ù† Ø£ÙˆÙ„ Ø¬Ù‡Ø§Ø² ÙŠØ¯Ø®Ù„ ÙŠØªØ³Ø¬Ù„
                isBlocked: false,
                activationDate: Date.now()
            }).then(() => {
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                document.getElementById('resultArea').style.display = 'block';
                document.getElementById('codeDisplay').innerText = code;
                btn.innerHTML = 'âœ¨ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯';
                btn.disabled = false;
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚Ù„
                document.getElementById('stdName').value = '';
            }).catch((error) => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
                btn.innerHTML = 'âœ¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
                btn.disabled = false;
            });
        }

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø®
        function copyCode() {
            const code = document.getElementById('codeDisplay').innerText;
            navigator.clipboard.writeText(code).then(() => {
                alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: " + code);
            });
        }
    </script>

</body>
        </html>
        
